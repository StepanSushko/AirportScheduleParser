if (!require("ggplot2")) { install.packages("ggplot2"); require("ggplot2") }
#if (!require("RCurl")) { install.packages("RCurl"); require("RCurl") }
if (!require("qdap")) { install.packages("qdap"); require("qdap") }
if (!require("rvest")) { install.packages("rvest"); require("rvest") }
OneDay_TimeTable = function(u, sDate) {      tables = read_html(u, encoding = "UTF-8")     dff = html_nodes(tables, "table")     df = html_table( dff[9], fill = T)[[1]]     df = df[-c(1:6), c(2:5)]     colnames( df ) = df[1,]     df = df[-c(1), ]     library(stringr)     df$`Авиакомпания` = str_split_fixed( df$`рейс`, ",", 2)[,2]     df$`рейс` = str_split_fixed(df$`рейс`, ",", 2)[, 1]     df$`Номер рейса` = apply(str_split_fixed(df$`рейс`, " ", 3)[, 1:2], MARGIN = 1, FUN = paste, collapse = " ")     #df$`рейс` = str_split_fixed(df$`рейс`, " ", 3)[, 3]     #df$`рейс` = str_split_fixed(df$`рейс`, " ", 2)[, 3]     #df$`рейс` = str_split_fixed(df$`рейс`, " — ", 2)[,2]     df_div3 = html_nodes(tables, xpath = '//*[@class="b-timetable__tripname"]')     #str_split_fixed(html_text(html_nodes(df_div3, "a")), " — ", 3)[1, 1]     df$`Направление` = str_split_fixed( html_text(html_nodes(df_div3, "a")), " — ", 3)[, 2]     df_div4 = html_nodes(tables, xpath = '//*[@class="b-timetable__description"]')     df$`Самолёт` = str_split_fixed( html_text( df_div4 ), ", ", 2)[, 1]     #df = df[ , c(7,5,2,6, 8)]     df$`расписание`[1] = strsplit(df$`расписание`[1], ", ")[[1]][1]     df$`расписание` = as.POSIXlt(paste( sDate, df$`расписание`))     return(df) }
OneWeek_TimeTable = function(station) {     df = NULL     for(i in c(1:7))         {         cat(".",i,".")         df_tmp = OneDay_TimeTable(             paste("https://rasp.yandex.ru/station/",station,"?start=", Sys.Date() + 1 + i, "T00%3A00%3A00&span=24", sep = ""),             Sys.Date() + 3 + i)         df = rbind(df, df_tmp)     }     A320_1 = "Airbus A320"     A320_2 = "Airbus А320"     df$`Самолёт`[df$`Самолёт` == A320_2] = A320_1     return(df) }
df  = OneWeek_TimeTable("9866615")
df  = OneWeek_TimeTable("9866615")
df  = OneWeek_TimeTable("9866615")
